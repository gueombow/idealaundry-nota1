<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>IDEALAUNDRY</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:monospace;max-width:380px;margin:auto;padding:10px}
h2,h3{text-align:center;margin:4px 0}
label{font-size:13px;display:block;margin-top:6px}
input,select{width:100%;padding:5px;font-family:monospace;box-sizing:border-box}
.box{border:1px dashed #000;padding:6px;margin-top:6px}
button{width:100%;padding:6px;margin-top:5px}
.total{text-align:center;font-weight:bold;margin-top:10px}
.item{border-bottom:1px dashed #aaa;padding:4px 0;font-size:13px}
.hapus{background:#c00;color:#fff;border:none;padding:3px 6px;font-size:11px}
@media print{body{width:58mm}button{display:none}.box{border:none}}
</style>
</head>

<body>

<h2>IDEALAUNDRY</h2>

<div class="box">
<b>No Nota:</b> <span id="nota"></span><br>
<b>Tanggal:</b> <span id="tanggal"></span>
</div>

<div class="box">
<h3>DATA PELANGGAN</h3>
<input placeholder="Nama">
<input placeholder="Alamat">
<input placeholder="No. Telp">
</div>

<div class="box">
<h3>LAUNDRY KILOAN</h3>
<select id="kiloan" onchange="hitung()">
<option value="">Pilih Layanan</option>
<option value="7000">Cuci Setrika – Rp 7.000</option>
<option value="6000">Cuci Lipat – Rp 6.000</option>
<option value="8000">Express – Rp 8.000</option>
</select>
<input type="number" id="kg" placeholder="Berat (Kg)" oninput="hitung()">
</div>

<div class="box">
<h3>LAUNDRY SATUAN</h3>
<div id="listBarang"></div>

<input id="namaBarang" placeholder="Nama Barang">
<input id="hargaBarang" placeholder="Harga (Rp)">
<input type="number" id="jumlahBarang" value="1" placeholder="Jumlah">
<button onclick="tambahBarang()">+ Tambah Barang</button>
</div>

<div class="box">
<h3>PEMBAYARAN</h3>
<input id="dp" placeholder="DP (Rp)" value="0">
<select id="statusBayar">
<option>BELUM LUNAS</option>
<option>LUNAS</option>
</select>
</div>

<div class="total">
TOTAL : Rp <span id="total">0</span><br>
DP : Rp <span id="dpText">0</span><br>
SISA : Rp <span id="sisa">0</span><br>
<span id="statusText"></span>
</div>

<div class="box">
<h3>REKAP HARI INI</h3>
Transaksi : <span id="trx">0</span><br>
Omset : Rp <span id="omset">0</span>
</div>

<button onclick="simpan()">Simpan Transaksi</button>
<button onclick="window.print()">Print</button>

<script>
const today=new Date();
const key=today.toISOString().slice(0,10);
tanggal.innerText=today.toLocaleDateString("id-ID");

// NOTA OTOMATIS
let no=localStorage.getItem("nota_"+key);
no=no?parseInt(no)+1:1;
localStorage.setItem("nota_"+key,no);
nota.innerText=key.replace(/-/g,"")+"-"+no;

// DATA BARANG
let barang=[];

function rp(x){return Number(x).toLocaleString("id-ID")}

function tambahBarang(){
 let n=namaBarang.value;
 let h=parseInt(hargaBarang.value.replace(/\./g,''))||0;
 let j=parseInt(jumlahBarang.value)||0;
 if(!n||h<=0||j<=0)return;

 barang.push({n,h,j,t:h*j});
 render();
 hitung();
 namaBarang.value="";hargaBarang.value="";jumlahBarang.value=1;
}

function hapus(i){
 barang.splice(i,1);
 render();hitung();
}

function render(){
 listBarang.innerHTML="";
 barang.forEach((b,i)=>{
  listBarang.innerHTML+=`
  <div class="item">
  <b>${b.n}</b><br>
  Rp ${rp(b.h)} x ${b.j} = Rp ${rp(b.t)}<br>
  <button class="hapus" onclick="hapus(${i})">Hapus</button>
  </div>`;
 });
}

function hitung(){
 let kilo=(kg.value||0)*(kiloan.value||0);
 let satuan=barang.reduce((a,b)=>a+b.t,0);
 let totalAll=kilo+satuan;

 let dpVal=parseInt(dp.value.replace(/\./g,''))||0;

 total.innerText=rp(totalAll);
 dpText.innerText=rp(dpVal);
 let sisaVal=totalAll-dpVal;
 sisa.innerText=rp(sisaVal>0?sisaVal:0);

 statusBayar.value=sisaVal<=0&&totalAll>0?"LUNAS":"BELUM LUNAS";
 statusText.innerText="STATUS : "+statusBayar.value;
 statusText.style.color=statusBayar.value==="LUNAS"?"green":"red";
}

hargaBarang.oninput=e=>{
 e.target.value=rp(e.target.value.replace(/\D/g,''));
}
dp.oninput=e=>{
 e.target.value=rp(e.target.value.replace(/\D/g,''));
 hitung();
}

// REKAP
function simpan(){
 let t=parseInt(total.innerText.replace(/\./g,''))||0;
 if(t<=0)return alert("Belum ada transaksi");

 let d=JSON.parse(localStorage.getItem("rekap_"+key))||{trx:0,omset:0};
 d.trx++; d.omset+=t;
 localStorage.setItem("rekap_"+key,JSON.stringify(d));
 load();
 alert("Transaksi disimpan");
}

function load(){
 let d=JSON.parse(localStorage.getItem("rekap_"+key))||{trx:0,omset:0};
 trx.innerText=d.trx;
 omset.innerText=rp(d.omset);
}
load();
</script>

</body>
</html>
