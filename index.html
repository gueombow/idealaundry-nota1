<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>IDEALAUNDRY SYSTEM</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:monospace;max-width:380px;margin:auto;padding:10px}
h2,h3{text-align:center;margin:4px 0}
label{font-size:13px;margin-top:6px;display:block}
input,select{width:100%;padding:5px;font-family:monospace;box-sizing:border-box}
.box{border:1px dashed #000;padding:6px;margin-top:6px}
button{width:100%;padding:6px;margin-top:5px}
.total{font-weight:bold;text-align:center;margin-top:10px}
.itemRow{border-bottom:1px dashed #aaa;padding:4px 0;font-size:13px}
.hapusBtn{background:#c00;color:#fff;border:none;padding:3px 6px;font-size:11px}
@media print{body{width:58mm}button{display:none}.box{border:none}}
</style>
</head>

<body>

<h2>IDEALAUNDRY</h2>

<div class="box">
<b>No Nota:</b> <span id="nota"></span><br>
<b>Tanggal:</b> <span id="tanggal"></span>
</div>

<div class="box">
<h3>DATA PELANGGAN</h3>
<input type="text" id="namaPelanggan" placeholder="Nama">
<input type="text" id="alamatPelanggan" placeholder="Alamat">
<input type="text" id="telpPelanggan" placeholder="No. Telp">
</div>

<div class="box">
<h3>KILOAN</h3>
<select id="kiloan" onchange="hitung()">
<option value="">Pilih layanan</option>
<option value="7000">Cuci Setrika 7.000</option>
<option value="6000">Cuci Lipat 6.000</option>
<option value="8000">Express 8.000</option>
</select>
<input type="number" id="kg" value="0" placeholder="Kg" oninput="hitung()">
</div>

<div class="box">
<h3>BARANG SATUAN</h3>
<div id="listBarang"></div>

<input type="text" id="namaBarang" placeholder="Nama Barang">
<input type="text" id="hargaBarang" placeholder="Harga (Rp)">
<input type="number" id="jumlahBarang" value="1" placeholder="Jumlah">
<button onclick="tambahBarang()">+ Tambah Barang</button>
</div>

<div class="box">
<h3>PEMBAYARAN</h3>
<input type="text" id="dp" value="0" placeholder="DP (Rp)">
<select id="statusBayar" onchange="tampilStatus()">
<option value="BELUM LUNAS">BELUM LUNAS</option>
<option value="LUNAS">LUNAS</option>
</select>
</div>

<div class="total">
Total : Rp <span id="total">0</span><br>
DP : Rp <span id="dpText">0</span><br>
Sisa : Rp <span id="sisa">0</span><br>
<span id="statusText"></span>
</div>

<div class="box">
<h3>REKAP HARI INI</h3>
Transaksi : <span id="rekapTransaksi">0</span><br>
Omset : Rp <span id="rekapOmset">0</span>
</div>

<button onclick="simpanTransaksi()">Simpan Transaksi</button>
<button onclick="window.print()">Print</button>

<script>
const today=new Date();
const tglKey=today.toISOString().split("T")[0];
tanggal.innerText=today.toLocaleDateString("id-ID");

// ================= NOMOR NOTA OTOMATIS =================
let nomor=localStorage.getItem("nota_"+tglKey);
nomor=nomor?parseInt(nomor)+1:1;
localStorage.setItem("nota_"+tglKey,nomor);
nota.innerText=tglKey.replace(/-/g,"")+"-"+nomor;

// ================= DATA BARANG =================
let dataBarang=[];

function formatRupiah(angka){
 return Number(angka).toLocaleString("id-ID");
}

function tambahBarang(){
 let nama=namaBarang.value;
 let harga=parseInt(hargaBarang.value.replace(/\./g,''))||0;
 let jumlah=parseInt(jumlahBarang.value)||0;
 if(!nama||harga<=0||jumlah<=0)return;

 let totalItem=harga*jumlah;
 dataBarang.push({nama,harga,jumlah,total:totalItem});
 renderBarang();
 namaBarang.value="";
 hargaBarang.value="";
 jumlahBarang.value=1;
 hitung();
}

function hapusBarang(i){
 dataBarang.splice(i,1);
 renderBarang();
 hitung();
}

function renderBarang(){
 listBarang.innerHTML="";
 dataBarang.forEach((b,i)=>{
  listBarang.innerHTML+=`
  <div class="itemRow">
  <b>${b.nama}</b><br>
  Rp ${formatRupiah(b.harga)} x ${b.jumlah}
  = Rp ${formatRupiah(b.total)}<br>
  <button class="hapusBtn" onclick="hapusBarang(${i})">Hapus</button>
  </div>`;
 });
}

// ================= HITUNG TOTAL =================
function hitung(){
 let totalKilo=(kg.value||0)*(kiloan.value||0);
 let totalBarang=0;
 dataBarang.forEach(b=>totalBarang+=b.total);
 let totalAll=totalKilo+totalBarang;

 let dpValue=parseInt(dp.value.replace(/\./g,''))||0;

 total.innerText=formatRupiah(totalAll);
 dpText.innerText=formatRupiah(dpValue);
 let sisaValue=totalAll-dpValue;
 sisa.innerText=formatRupiah(sisaValue>0?sisaValue:0);

 if(sisaValue<=0 && totalAll>0){
  statusBayar.value="LUNAS";
 }else{
  statusBayar.value="BELUM LUNAS";
 }
 tampilStatus();
}

// format input rupiah
hargaBarang.addEventListener("input",e=>{
 let angka=e.target.value.replace(/\D/g,'');
 e.target.value=formatRupiah(angka);
});
dp.addEventListener("input",e=>{
 let angka=e.target.value.replace(/\D/g,'');
 e.target.value=formatRupiah(angka);
 hitung();
});

function tampilStatus(){
 statusText.innerText="STATUS : "+statusBayar.value;
 statusText.style.color=statusBayar.value==="LUNAS"?"green":"red";
}

// ================= SIMPAN & REKAP =================
function simpanTransaksi(){
 let totalAll=parseInt(total.innerText.replace(/\./g,''))||0;
 if(totalAll<=0)return alert("Belum ada transaksi");

 let data=JSON.parse(localStorage.getItem("rekap_"+tglKey))||{
  transaksi:0,
  omset:0
 };

 data.transaksi+=1;
 data.omset+=totalAll;

 localStorage.setItem("rekap_"+tglKey,JSON.stringify(data));
 loadRekap();
 alert("Transaksi disimpan!");
}

function loadRekap(){
 let data=JSON.parse(localStorage.getItem("rekap_"+tglKey))||{
  transaksi:0,
  omset:0
 };
 rekapTransaksi.innerText=data.transaksi;
 rekapOmset.innerText=formatRupiah(data.omset);
}

loadRekap();
tampilStatus();
</script>

</body>
</html>
